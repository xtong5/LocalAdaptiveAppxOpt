\subsection{Computational Cost}

In this part, we investigate the computational cost of our locally adaptive algorithm. Let $n_0$ denote the initial number of intervals and $L$ be the final number of intervals. We firstly introduce one new notation $\Ixl$. Let
\begin{align*}
\Ixl & = \text{unique interval containing $x$ whose width is $\frac{2^{-l}(b-a)}{n_0}$}\\
& = [x_{i-1},x_i), \qquad i =1,\ldots,L.
\end{align*}
where $l \in \natzero$ is the number of iterations.

Thus, for subinterval $I_{x,l}$, we have the error bound from~\eqref{appxerrbdb}
$$\errest(x,l)=\frac{(x_i - x_{i-1})^2B(f,[x_{i-1},x_i])}{8}.$$

Denote
\begin{equation}\label{eqn:defofsmallellx}
\ell(x) = \min \{ l \in \natzero : \errest(x,l) \le \varepsilon\}.
\end{equation}

For $i \in \{3, \ldots, L-2\}$,  as $\fC$ a is non-decreasing function and by \eqref{normbd}, we know
\begin{align*}
B(f,[x_{i-1},x_i]) & \le \fC\left(\frac{2(b-a)}{n_0}\right) \max\limits_{x_{i-3}\le t \le x_{i+2}}\abs{f''(t)}.
%&\le \fC\left(\frac{2(b-a)}{n_0}\right) \max\limits_{\max\{a,x-\delta\} \le t \le \min\{x+\delta, b\}}\abs{f''(t)},\\
\end{align*}
Similar for $i\in \{1,2\}$, we have
\begin{align*}
B(f,[x_{i-1},x_i]) & \le \fC\left(\frac{3(b-a)}{n_0}\right) \max\limits_{x_{i}\le t \le x_{i+2}}\abs{f''(t)}.
%&\le \fC\left(\frac{2(b-a)}{n_0}\right) \max\limits_{\max\{a,x-\delta\} \le t \le \min\{x+\delta, b\}}\abs{f''(t)},\\
\end{align*}
Thus for $i \in \{L-1,L\}$, we have
\begin{align*}
B(f,[x_{i-1},x_i]) & \le \fC\left(\frac{3(b-a)}{n_0}\right) \max\limits_{x_{i-3}\le t \le x_{i-1}}\abs{f''(t)}.
%&\le \fC\left(\frac{2(b-a)}{n_0}\right) \max\limits_{\max\{a,x-\delta\} \le t \le \min\{x+\delta, b\}}\abs{f''(t)},\\
\end{align*}
Therefore, for any $i \in \{1,2,\ldots, L\}$ we can obtain
\begin{align*}
B(f,[x_{i-1},x_i]) & \le \fC\left(\frac{3(b-a)}{n_0}\right) \max\limits_{\max\{a,x-\delta\} \le t \le \min\{x+\delta, b\}}\abs{f''(t)},
\end{align*}
where 
\[\delta = \frac{3\cdot 2^{-l_{-}(b-a)}}{n_0}, \qquad l_{-}=\min\{l_{i-3},l_{i-2},\ldots,l_{i+2}\}.\]
If the index $k$ of $l$ is greater than $L$ or less than $0$, let $l_k=\infty$.

Denote
$\norm[x,l,\delta]{f''}=\max\limits_{\max\{a,x-\delta\} \le t \le \min\{x+\delta, b\}}\abs{f''(t)},$
we can obtain an upper bound on $\errest(x,l)$ in terms of $\norm[x,l,\delta]{f''}$:
\[
 \errest(x,l)  \le C_l \norm[x,l,\delta]{f''}, \qquad \forall x \in [a,b], \ l \in \natzero,
\]
where
\[\qquad C_l=\fC\left(\frac{3(b-a)}{n_0}\right) \frac{2^{-2l}(b-a)^2}{8n^2_0}
\]
depends on $n_0$, $\fC$, and $l$, but not on $f$.

Thus we can just define
\begin{equation}\label{eqn:defoflx}
L(x) = \min \left\{ l \in \natzero : C_l \norm[x,l,\delta]{f''} \le \varepsilon\right\} .
\end{equation}
It is easy to obtain $\ell(x) \le L(x)$.
Next we want to investigate $2^{L(x)}$.
$$
2^{L(x)}=2^{\min \left\{ l \in \natzero : C_l \norm[x,l,\delta]{f''}\le \varepsilon\right\}} = \min\left\{2^l: l \in  \natzero, C_l \norm[x,l,\delta]{f''}\le \varepsilon\right\}.$$
Denote
\begin{align}\label{mxdef}
M(x) & = \min\left\{2^l:  \fC\left(\frac{3(b-a)}{n_0}\right) \frac{2^{-2l}(b-a)^2}{8n^2_0}\norm[x,l,\delta]{f''} \le \varepsilon,  l \in  \natzero\right\}\nonumber \\
 & = \min\left\{2^l:  2^l \ge \sqrt{\frac{\fC\left(\frac{3(b-a)}{n_0}\right)  (b-a)^2 \norm[x,l,\delta]{f''}}{8n^2_0\varepsilon}},  l \in  \natzero\right\}.
\end{align}
We obtain the upper bound on computational cost of Algorithm \texttt{funappx\_g}.

\begin{theorem}\label{thm:cost}
Let $A(f,\varepsilon)$ be the adaptive linear spline defined by Algorithm \textnormal{\texttt{funappx\_g}}, and let $n_0$, and $\varepsilon$ be the inputs and parameters described there. Let $\cc$ be the cone of functions defined in~\eqref{conedef}.
Let $M(x)$ is defined in~\eqref{mxdef}.
Then it follows that Algorithm \textnormal{\texttt{funappx\_g}} is successful for all functions in $\cc$,  i.e.,  $\norm[\infty]{f - S(f, \cdot)} \le \varepsilon$.  Moreover, the cost of this algorithm is bounded above as follows:
$$\cost(S,f,\varepsilon) \le \frac{n_0}{b-a}\int_a^b M(x) dx +1.$$
\end{theorem}

\begin{proof}
For subinterval $I_{x,\ell(x)}$, where $\ell(x)$ is defined in~\eqref{eqn:defofsmallellx},
which means Algorithm \texttt{funappx\_g} satisfied error tolerance on $I_{x,\ell(x)}$ with two points.
If we take out the right end point of the subinterval, then the density of the cost on $I_{x,\ell(x)}$ can be considered as
$$\frac{n_0}{2^{-\ell(x)}(b-a)}.$$
Thus, we obtain the cost on whole interval $[a,b]$ should be
$$\cost(S,f,\varepsilon)  = \int_a^b \frac{n_0}{2^{-\ell(x)}(b-a)}dx +1= \frac{n_0}{(b-a)}\int_a^b 2^{\ell(x)}dx +1.
$$
If $L(x)$ is defined in~\eqref{eqn:defoflx}, then we know $\ell(x) \le L(x)$. Therefore we obtain an upper bound
$$\cost(S,f,\varepsilon)  \le \frac{n_0}{(b-a)}\int_a^b 2^{L(x)}dx +1.
$$
As $M(x)=2^{L(x)}$ by the definition~\eqref{mxdef}, we obtain
$$\cost(S,f,\varepsilon)  \le \frac{n_0}{(b-a)}\int_a^b M(x) dx +1.
$$
\end{proof}

From Theorem~\ref{thm:cost}, we know for very small $\varepsilon$,
$l$ tends to $\infty$, $\norm[x,l,\delta]{f''}$ tends to $|f''(x)|$.
Thus we can have
$$ M(x) \lesssim 2\sqrt{\frac{\fC\left(\frac{3(b-a)}{n_0}\right)  (b-a)^2 |f''(x)|}{8n^2_0\varepsilon}}.$$
The upper bound on computational cost tends to
\begin{align*}
\cost(S,f,\varepsilon)  & \lesssim \frac{n_0}{(b-a)}\int_a^b 2\sqrt{\frac{\fC\left(\frac{3(b-a)}{n_0}\right)  (b-a)^2 |f''(x)|}{8n^2_0\varepsilon}} dx +1 \\
& =\sqrt{\frac{\fC\left(\frac{3(b-a)}{n_0}\right)}{2\varepsilon}}\int_a^b \sqrt{|f''(x)|} dx +1\\
& =\sqrt{\frac{\fC\left(\frac{3(b-a)}{n_0}\right)}{2\varepsilon}}\norm[1]{\sqrt{|f''|}} dx +1,
\end{align*}
where $\norm[1]{g}=\int_a^b |g''(x)| dx$.
However, when $\varepsilon$ is not that small, the computational cost does not only depend on $\int_a^b|f''(x)|dx$ but also depends on where and how the peaky parts are located.\\